<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stella æ—¥æŠ¥åŠ©æ‰‹ (æ¸…å•ç‰ˆ)</title>
    <style>
        /* æ ·å¼éƒ¨åˆ† */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 15px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            padding-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            background: #eef1f6;
            padding: 5px;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            border-radius: 8px;
        }
        .nav-item.active {
            background: #fff;
            color: #409EFF;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .content-section { display: none; padding: 20px; }
        .content-section.active { display: block; }

        h2 { text-align: center; color: #333; margin-top: 0; font-size: 1.2rem; }
        .user-badge {
            display: block; text-align: center; background: #e1f3d8; color: #67C23A;
            font-size: 12px; padding: 4px; border-radius: 4px; width: fit-content; margin: 0 auto 15px auto;
        }

        label {
            display: block; margin-top: 20px; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #555;
        }

        /* ä»»åŠ¡åˆ—è¡¨æ ·å¼ */
        .task-list { margin-bottom: 10px; }
        .task-row {
            display: flex; align-items: center; margin-bottom: 8px;
        }
        .task-check {
            width: 24px; height: 24px; margin-right: 8px; cursor: pointer;
        }
        .task-input {
            flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; outline: none; font-size: 16px;
        }
        .task-input:focus { border-color: #409EFF; }
        .btn-del {
            background: #ffeded; color: #f56c6c; border: none; padding: 0 10px; margin-left: 5px;
            border-radius: 6px; cursor: pointer; height: 40px; font-size: 18px; line-height: 1;
        }

        .btn-add {
            background: #ecf5ff; color: #409EFF; border: 1px dashed #409EFF; width: 100%;
            padding: 8px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-bottom: 10px;
        }

        /* æ™®é€šæ–‡æœ¬æ¡† (ç”¨äºâ€œè®¡åˆ’å¤–â€å’Œâ€œå…¶ä»–â€) */
        textarea, input[type="date"] {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;
            box-sizing: border-box; font-size: 16px; outline: none;
        }

        button.main-btn {
            width: 100%; padding: 14px; margin-top: 20px; border: none; border-radius: 8px;
            font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .btn-primary { background-color: #409EFF; color: white; }
        .btn-success { background-color: #67C23A; color: white; display: none; margin-top: 10px;}
        .btn-warning { background-color: #E6A23C; color: white; }

        .result-box {
            margin-top: 20px; background: #f9fafc; border: 1px dashed #ccc; padding: 15px;
            border-radius: 6px; white-space: pre-wrap; font-size: 14px; line-height: 1.6; display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <div class="nav-item active" onclick="switchTab('daily')">å†™æ—¥æŠ¥</div>
        <div class="nav-item" onclick="switchTab('weekly')">ç”Ÿæˆå‘¨æŠ¥</div>
    </div>

    <div id="tab-daily" class="content-section active">
        <h2>ğŸ“… ä»Šæ—¥æ±‡æŠ¥</h2>
        <div class="user-badge">å½“å‰ç”¨æˆ·ï¼šStella</div>

        <label>1. ä»Šæ—¥è®¡åˆ’å·¥ä½œ (æ‰“é’©ä»£è¡¨å®Œæˆ)</label>
        <div id="list-today" class="task-list"></div>
        <button class="btn-add" onclick="addTask('list-today')">+ æ·»åŠ ä¸€é¡¹ä»»åŠ¡</button>

        <label>2. ä»Šæ—¥è®¡åˆ’å¤–äº‹é¡¹</label>
        <textarea id="workExtra" rows="2" placeholder="ä¸´æ—¶æ’å…¥äº†ä»€ä¹ˆå·¥ä½œï¼Ÿï¼ˆæ— åˆ™å¡«æ— ï¼‰"></textarea>

        <label>3. æ˜æ—¥è®¡åˆ’å·¥ä½œ</label>
        <div id="list-tomorrow" class="task-list"></div>
        <button class="btn-add" onclick="addTask('list-tomorrow')">+ æ·»åŠ ä¸€é¡¹ä»»åŠ¡</button>

        <label>4. å…¶ä»–</label>
        <textarea id="otherInfo" rows="2" placeholder="éœ€åè°ƒèµ„æºæˆ–é‡åˆ°çš„å›°éš¾..."></textarea>

        <button class="main-btn btn-primary" onclick="generateDaily()">ç”Ÿæˆå¹¶ä¿å­˜æ—¥æŠ¥</button>
        
        <div id="dailyResult" class="result-box"></div>
        <button id="copyDailyBtn" class="main-btn btn-success" onclick="copyText('dailyResult')">å¤åˆ¶æ—¥æŠ¥å†…å®¹</button>
    </div>

    <div id="tab-weekly" class="content-section">
        <h2>ğŸ“Š å‘¨å·¥ä½œæ€»ç»“</h2>
        <div class="user-badge">å½“å‰ç”¨æˆ·ï¼šStella</div>
        
        <label>å¼€å§‹æ—¥æœŸ</label>
        <input type="date" id="startDate">
        <label>ç»“æŸæ—¥æœŸ</label>
        <input type="date" id="endDate">

        <button class="main-btn btn-warning" onclick="generateWeekly()">ä¸€é”®ç”Ÿæˆå‘¨æŠ¥</button>

        <div id="weeklyResult" class="result-box"></div>
        <button id="copyWeeklyBtn" class="main-btn btn-success" onclick="copyText('weeklyResult')">å¤åˆ¶å‘¨æŠ¥å†…å®¹</button>
    </div>
</div>

<script>
    var FIXED_NAME = "Stella"; 

    // åˆå§‹åŒ–
    window.onload = function() {
        // è®¾ç½®é»˜è®¤æ—¥æœŸ
        var today = new Date();
        document.getElementById('endDate').valueAsDate = today;
        var lastWeek = new Date();
        lastWeek.setDate(today.getDate() - 6);
        document.getElementById('startDate').valueAsDate = lastWeek;

        // é»˜è®¤å„æ·»åŠ ä¸€è¡Œç©ºä»»åŠ¡ï¼Œæ–¹ä¾¿ç›´æ¥è¾“å…¥
        addTask('list-today');
        addTask('list-tomorrow');
    };

    function switchTab(tabName) {
        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        if(tabName === 'daily') document.querySelector('.nav-item:nth-child(1)').classList.add('active');
        if(tabName === 'weekly') document.querySelector('.nav-item:nth-child(2)').classList.add('active');
    }

    // --- ä»»åŠ¡æ¸…å•é€»è¾‘ ---
    
    // æ·»åŠ ä¸€è¡Œä»»åŠ¡
    function addTask(containerId) {
        var container = document.getElementById(containerId);
        var div = document.createElement("div");
        div.className = "task-row";
        div.innerHTML = `
            <input type="checkbox" class="task-check">
            <input type="text" class="task-input" placeholder="è¾“å…¥ä»»åŠ¡å†…å®¹...">
            <button class="btn-del" onclick="this.parentElement.remove()">Ã—</button>
        `;
        container.appendChild(div);
    }

    // è¯»å–æ¸…å•å†…å®¹å¹¶è½¬åŒ–ä¸ºå¸¦ç¬¦å·çš„æ–‡æœ¬
    function getListContent(containerId) {
        var container = document.getElementById(containerId);
        var rows = container.querySelectorAll(".task-row");
        var result = [];
        
        rows.forEach(row => {
            var isChecked = row.querySelector(".task-check").checked;
            var text = row.querySelector(".task-input").value.trim();
            if (text) {
                // å¦‚æœå‹¾é€‰äº†ç”¨ â˜‘ï¼Œæ²¡å‹¾é€‰ç”¨ â˜
                var icon = isChecked ? "â˜‘ " : "â˜ ";
                result.push(icon + text);
            }
        });

        if (result.length === 0) return "æ— ";
        return result.join("\n");
    }

    // --- ç”Ÿæˆæ—¥æŠ¥ ---
    function generateDaily() {
        // è·å–æ•°æ®
        var workPlanned = getListContent('list-today');
        var planTomorrow = getListContent('list-tomorrow');
        
        var workExtra = document.getElementById("workExtra").value || "æ— ";
        var otherInfo = document.getElementById("otherInfo").value || "æ— ";

        // ç”Ÿæˆæ–‡æœ¬
        var now = new Date();
        var dateStr = (now.getMonth() + 1) + "æœˆ" + now.getDate() + "æ—¥";
        var dateKey = now.toISOString().split('T')[0]; 

        var reportText = `ã€æ—¥æŠ¥ã€‘${FIXED_NAME} ${dateStr}\n` +
                         `----------------\n` +
                         `1.ã€ä»Šæ—¥è®¡åˆ’å·¥ä½œã€‘\n${workPlanned}\n\n` +
                         `2.ã€ä»Šæ—¥è®¡åˆ’å¤–äº‹é¡¹ã€‘\n${workExtra}\n\n` +
                         `3.ã€æ˜æ—¥è®¡åˆ’å·¥ä½œã€‘\n${planTomorrow}\n\n` +
                         `4.ã€å…¶ä»–ã€‘\n${otherInfo}`;

        // æ˜¾ç¤º
        var box = document.getElementById("dailyResult");
        box.innerText = reportText;
        box.style.display = "block";
        document.getElementById("copyDailyBtn").style.display = "block";

        // ä¿å­˜ï¼ˆæ³¨æ„ï¼šè¿™é‡Œç›´æ¥ä¿å­˜ç”Ÿæˆçš„å¸¦ç¬¦å·å­—ç¬¦ä¸²ï¼Œè¿™æ ·å‘¨æŠ¥åŠŸèƒ½ä¸éœ€è¦ä¿®æ”¹å°±èƒ½ç›´æ¥è¯»å–ç¬¦å·ï¼‰
        var dailyData = {
            workPlanned: workPlanned,
            workExtra: workExtra,
            planTomorrow: planTomorrow,
            otherInfo: otherInfo
        };
        localStorage.setItem("report_" + dateKey, JSON.stringify(dailyData));
        alert("æ—¥æŠ¥å·²ä¿å­˜ï¼");
    }

    // --- ç”Ÿæˆå‘¨æŠ¥ (ä¿æŒé€»è¾‘ä¸å˜) ---
    function generateWeekly() {
        var startStr = document.getElementById("startDate").value;
        var endStr = document.getElementById("endDate").value;
        if (!startStr || !endStr) { alert("è¯·é€‰æ‹©æ—¥æœŸèŒƒå›´"); return; }

        var startDate = new Date(startStr);
        var endDate = new Date(endStr);
        var reportContent = `ã€å‘¨æŠ¥æ€»ç»“ã€‘${FIXED_NAME}\nå‘¨æœŸï¼š${startStr} è‡³ ${endStr}\n====================\n`;

        var currentLoop = new Date(startDate);
        var foundAny = false;

        while (currentLoop <= endDate) {
            var keyDate = currentLoop.toISOString().split('T')[0];
            var savedJson = localStorage.getItem("report_" + keyDate);
            var displayDate = (currentLoop.getMonth()+1) + "." + currentLoop.getDate();

            if (savedJson) {
                foundAny = true;
                var data = JSON.parse(savedJson);
                reportContent += `\nğŸ“… [${displayDate} å·¥ä½œè®°å½•]\n`;
                // è¿™é‡Œè¯»å–åˆ°çš„å·²ç»æ˜¯å¸¦ â˜‘ æˆ– â˜ çš„æ–‡æœ¬äº†
                reportContent += `${data.workPlanned}\n`; 
                if(data.workExtra !== "æ— ") reportContent += `(è®¡åˆ’å¤–: ${data.workExtra})\n`;
            }
            currentLoop.setDate(currentLoop.getDate() + 1);
        }

        if (!foundAny) {
            reportContent += "\n(æœªæ‰¾åˆ°æ­¤æœŸé—´çš„æ—¥æŠ¥è®°å½•)\n";
        } else {
            reportContent += `\n====================\nã€ä¸‹å‘¨è®¡åˆ’ã€‘\n(è¯·åœ¨æ­¤å¤„è¡¥å……ä¸‹å‘¨é‡ç‚¹)`;
        }

        var box = document.getElementById("weeklyResult");
        box.innerText = reportContent;
        box.style.display = "block";
        document.getElementById("copyWeeklyBtn").style.display = "block";
    }

    function copyText(elementId) {
        var text = document.getElementById(elementId).innerText;
        var tempInput = document.createElement("textarea");
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("å¤åˆ¶æˆåŠŸï¼");
    }
</script>

</body>

</html>
