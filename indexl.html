<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stella å·¥ä½œå° (æ‚è‰é›†ä¼˜å…ˆ)</title>
    <style>
        /* æ ·å¼éƒ¨åˆ† */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 15px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            padding-bottom: 20px;
            min-height: 80vh;
        }

        /* é¡¶éƒ¨å¯¼èˆªåˆ‡æ¢ */
        .nav-tabs {
            display: flex;
            background: #eef1f6;
            padding: 5px;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 5px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            border-radius: 8px;
            font-size: 14px;
        }
        .nav-item.active {
            background: #fff;
            color: #409EFF;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .content-section { display: none; padding: 20px; }
        .content-section.active { display: block; }

        h2 { text-align: center; color: #333; margin-top: 0; font-size: 1.2rem; }
        .user-badge {
            display: block; text-align: center; background: #e1f3d8; color: #67C23A;
            font-size: 12px; padding: 4px; border-radius: 4px; width: fit-content; margin: 0 auto 15px auto;
        }

        label {
            display: block; margin-top: 20px; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #555;
        }

        /* ä»»åŠ¡åˆ—è¡¨æ ·å¼ */
        .task-list { margin-bottom: 10px; }
        .task-row { display: flex; align-items: center; margin-bottom: 8px; }
        .task-check { width: 24px; height: 24px; margin-right: 8px; cursor: pointer; }
        .task-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; outline: none; font-size: 16px; }
        .task-input:focus { border-color: #409EFF; }
        .btn-del { background: #ffeded; color: #f56c6c; border: none; padding: 0 10px; margin-left: 5px; border-radius: 6px; cursor: pointer; height: 40px; font-size: 18px; }

        .btn-add { background: #ecf5ff; color: #409EFF; border: 1px dashed #409EFF; width: 100%; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-bottom: 10px; }

        /* æ–‡æœ¬æ¡†æ ·å¼ */
        textarea, input[type="date"] {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;
            box-sizing: border-box; font-size: 16px; outline: none;
            font-family: inherit;
        }
        textarea:focus { border-color: #409EFF; }

        /* æ‚è‰é›†ä¸“å±æ ·å¼ */
        #weedText {
            background-color: #fffef9; 
            line-height: 1.6;
            color: #444;
            border: 1px solid #e6dab8;
        }

        button.main-btn {
            width: 100%; padding: 14px; margin-top: 20px; border: none; border-radius: 8px;
            font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .btn-primary { background-color: #409EFF; color: white; }
        .btn-success { background-color: #67C23A; color: white; margin-top: 10px;}
        .btn-warning { background-color: #E6A23C; color: white; }
        
        .btn-save-mini {
            background-color: #409EFF; color: white; border: none; padding: 8px 20px;
            border-radius: 20px; font-size: 14px; cursor: pointer; float: right; margin-bottom: 10px;
        }

        .result-box {
            margin-top: 20px; background: #f9fafc; border: 1px dashed #ccc; padding: 15px;
            border-radius: 6px; white-space: pre-wrap; font-size: 14px; line-height: 1.6; display: none;
        }
        .tip { font-size: 12px; color: #999; text-align: center; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <div class="nav-item active" onclick="switchTab('weed')">ğŸŒ± æ‚è‰é›†</div>
        <div class="nav-item" onclick="switchTab('daily')">å†™æ—¥æŠ¥</div>
        <div class="nav-item" onclick="switchTab('weekly')">ç”Ÿæˆå‘¨æŠ¥</div>
    </div>

    <div id="tab-weed" class="content-section active">
        <h2>ğŸŒ± æ€ç»´æ‚è‰é›†</h2>
        <div class="tip">è¿™é‡Œçš„å†…å®¹ä¼šæ°¸ä¹…ä¿å­˜ï¼Œé™¤éä½ åˆ é™¤å®ƒã€‚</div>
        
        <button class="btn-save-mini" onclick="saveWeed()">ğŸ’¾ ä¿å­˜ç¬”è®°</button>
        <div style="clear:both;"></div>

        <textarea id="weedText" rows="15" placeholder="åœ¨æ­¤å¤„éšæ„è®°å½•çµæ„Ÿã€å¾…åŠã€ä¼šè®®çºªè¦..."></textarea>
        
        <button class="main-btn btn-success" onclick="copyWeed()">ä¸€é”®å¤åˆ¶ç¬”è®°</button>
    </div>

    <div id="tab-daily" class="content-section">
        <h2>ğŸ“… ä»Šæ—¥æ±‡æŠ¥</h2>
        <div class="user-badge">å½“å‰ç”¨æˆ·ï¼šStella</div>

        <label>1. ä»Šæ—¥è®¡åˆ’ (æ‰“é’©=å®Œæˆ)</label>
        <div id="list-today" class="task-list"></div>
        <button class="btn-add" onclick="addTask('list-today')">+ æ·»åŠ ä»»åŠ¡</button>

        <label>2. è®¡åˆ’å¤–äº‹é¡¹</label>
        <textarea id="workExtra" rows="2" placeholder="æ— "></textarea>

        <label>3. æ˜æ—¥è®¡åˆ’</label>
        <div id="list-tomorrow" class="task-list"></div>
        <button class="btn-add" onclick="addTask('list-tomorrow')">+ æ·»åŠ ä»»åŠ¡</button>

        <label>4. å…¶ä»–</label>
        <textarea id="otherInfo" rows="2" placeholder="æ— "></textarea>

        <button class="main-btn btn-primary" onclick="generateDaily()">ç”Ÿæˆå¹¶ä¿å­˜æ—¥æŠ¥</button>
        <div id="dailyResult" class="result-box"></div>
        <button id="copyDailyBtn" class="main-btn btn-success" style="display:none" onclick="copyText('dailyResult')">å¤åˆ¶å†…å®¹</button>
    </div>

    <div id="tab-weekly" class="content-section">
        <h2>ğŸ“Š å‘¨å·¥ä½œæ€»ç»“</h2>
        <p class="tip">é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼Œè‡ªåŠ¨æ±‡æ€»è¿‡å¾€æ—¥æŠ¥</p>
        
        <label>å¼€å§‹æ—¥æœŸ</label>
        <input type="date" id="startDate">
        <label>ç»“æŸæ—¥æœŸ</label>
        <input type="date" id="endDate">

        <button class="main-btn btn-warning" onclick="generateWeekly()">ä¸€é”®ç”Ÿæˆå‘¨æŠ¥</button>
        <div id="weeklyResult" class="result-box"></div>
        <button id="copyWeeklyBtn" class="main-btn btn-success" style="display:none" onclick="copyText('weeklyResult')">å¤åˆ¶å†…å®¹</button>
    </div>
</div>

<script>
    var FIXED_NAME = "Stella"; 

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        // 1. è®¾ç½®å‘¨æŠ¥æ—¥æœŸ
        var today = new Date();
        document.getElementById('endDate').valueAsDate = today;
        var lastWeek = new Date();
        lastWeek.setDate(today.getDate() - 6);
        document.getElementById('startDate').valueAsDate = lastWeek;

        // 2. åˆå§‹åŒ–ä»»åŠ¡è¡Œ
        addTask('list-today');
        addTask('list-tomorrow');

        // 3. è¯»å–æ‚è‰é›†çš„å†…å®¹
        var savedWeed = localStorage.getItem("weed_note_content");
        if (savedWeed) {
            document.getElementById("weedText").value = savedWeed;
        }
    };

    // --- åˆ‡æ¢æ ‡ç­¾é¡µ (é€»è¾‘æ›´æ–°) ---
    function switchTab(tabName) {
        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        
        document.getElementById('tab-' + tabName).classList.add('active');
        
        // æ›´æ–°é«˜äº®é€»è¾‘ï¼š0=æ‚è‰é›†, 1=æ—¥æŠ¥, 2=å‘¨æŠ¥
        if(tabName === 'weed') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(tabName === 'daily') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(tabName === 'weekly') document.querySelectorAll('.nav-item')[2].classList.add('active');
    }

    // --- æ‚è‰é›†é€»è¾‘ ---
    function saveWeed() {
        var content = document.getElementById("weedText").value;
        localStorage.setItem("weed_note_content", content); 
        alert("æ‚è‰é›†å·²ä¿å­˜ï¼ğŸƒ");
    }

    function copyWeed() {
        saveWeed(); // å¤åˆ¶å‰å…ˆä¿å­˜
        var text = document.getElementById("weedText").value;
        if(!text) { alert("è¿™é‡Œç©ºç©ºå¦‚ä¹Ÿï¼Œæ²¡å•¥å¥½å¤åˆ¶çš„~"); return; }
        
        var tempInput = document.createElement("textarea");
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("å¤åˆ¶æˆåŠŸï¼");
    }

    // --- æ—¥æŠ¥é€»è¾‘ ---
    function addTask(containerId) {
        var container = document.getElementById(containerId);
        var div = document.createElement("div");
        div.className = "task-row";
        div.innerHTML = `
            <input type="checkbox" class="task-check">
            <input type="text" class="task-input" placeholder="è¾“å…¥ä»»åŠ¡...">
            <button class="btn-del" onclick="this.parentElement.remove()">Ã—</button>
        `;
        container.appendChild(div);
    }

    function getListContent(containerId) {
        var rows = document.getElementById(containerId).querySelectorAll(".task-row");
        var result = [];
        rows.forEach(row => {
            var isChecked = row.querySelector(".task-check").checked;
            var text = row.querySelector(".task-input").value.trim();
            if (text) result.push((isChecked ? "â˜‘ " : "â˜ ") + text);
        });
        return result.length ? result.join("\n") : "æ— ";
    }

    function generateDaily() {
        var workPlanned = getListContent('list-today');
        var planTomorrow = getListContent('list-tomorrow');
        var workExtra = document.getElementById("workExtra").value || "æ— ";
        var otherInfo = document.getElementById("otherInfo").value || "æ— ";

        var now = new Date();
        var dateStr = (now.getMonth() + 1) + "æœˆ" + now.getDate() + "æ—¥";
        var dateKey = now.toISOString().split('T')[0]; 

        var reportText = `ã€æ—¥æŠ¥ã€‘${FIXED_NAME} ${dateStr}\n----------------\n` +
                         `1.ã€ä»Šæ—¥è®¡åˆ’ã€‘\n${workPlanned}\n\n` +
                         `2.ã€è®¡åˆ’å¤–ã€‘\n${workExtra}\n\n` +
                         `3.ã€æ˜æ—¥è®¡åˆ’ã€‘\n${planTomorrow}\n\n` +
                         `4.ã€å…¶ä»–ã€‘\n${otherInfo}`;

        var box = document.getElementById("dailyResult");
        box.innerText = reportText;
        box.style.display = "block";
        document.getElementById("copyDailyBtn").style.display = "block";

        var dailyData = { workPlanned, workExtra, planTomorrow, otherInfo };
        localStorage.setItem("report_" + dateKey, JSON.stringify(dailyData));
        alert("æ—¥æŠ¥å·²ä¿å­˜ï¼");
    }

    function generateWeekly() {
        var startStr = document.getElementById("startDate").value;
        var endStr = document.getElementById("endDate").value;
        if (!startStr || !endStr) { alert("è¯·é€‰æ‹©æ—¥æœŸèŒƒå›´"); return; }

        var startDate = new Date(startStr);
        var endDate = new Date(endStr);
        var reportContent = `ã€å‘¨æŠ¥æ€»ç»“ã€‘${FIXED_NAME}\nå‘¨æœŸï¼š${startStr} è‡³ ${endStr}\n====================\n`;
        var currentLoop = new Date(startDate);
        var foundAny = false;

        while (currentLoop <= endDate) {
            var keyDate = currentLoop.toISOString().split('T')[0];
            var savedJson = localStorage.getItem("report_" + keyDate);
            var displayDate = (currentLoop.getMonth()+1) + "." + currentLoop.getDate();

            if (savedJson) {
                foundAny = true;
                var data = JSON.parse(savedJson);
                reportContent += `\nğŸ“… [${displayDate}]\n${data.workPlanned}\n`; 
                if(data.workExtra !== "æ— ") reportContent += `(è®¡åˆ’å¤–: ${data.workExtra})\n`;
            }
            currentLoop.setDate(currentLoop.getDate() + 1);
        }
        if (!foundAny) reportContent += "\n(æœªæ‰¾åˆ°è®°å½•)\n";
        else reportContent += `\n====================\nã€ä¸‹å‘¨è®¡åˆ’ã€‘\n(è¯·åœ¨æ­¤å¤„è¡¥å……)`;

        var box = document.getElementById("weeklyResult");
        box.innerText = reportContent;
        box.style.display = "block";
        document.getElementById("copyWeeklyBtn").style.display = "block";
    }

    function copyText(elementId) {
        var text = document.getElementById(elementId).innerText;
        var tempInput = document.createElement("textarea");
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("å¤åˆ¶æˆåŠŸï¼");
    }
</script>

</body>
</html>